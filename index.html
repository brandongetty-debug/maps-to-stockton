<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maps to Stockton — Brandon Getty</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    background: #0a0a0a;
    color: #e8e4df;
    overflow: hidden;
    height: 100vh;
    width: 100vw;
  }

  /* ── Map ── */
  #map { position: absolute; inset: 0; z-index: 1; }

  /* ── Title overlay ── */
  #title-overlay {
    position: absolute;
    top: 24px;
    left: 80px;
    z-index: 1000;
    pointer-events: none;
    transition: opacity 0.4s ease;
  }
  #title-overlay h1 {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-weight: 500;
    font-size: 28px;
    letter-spacing: 0.02em;
    color: #fff;
    text-shadow: 0 2px 12px rgba(0,0,0,0.7);
    line-height: 1.2;
  }
  #title-overlay .subtitle {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-weight: 300;
    font-size: 12px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.6);
    text-shadow: 0 1px 8px rgba(0,0,0,0.7);
    margin-top: 4px;
  }

  /* ── Info bar ── */
  #info-bar {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    z-index: 1000;
    background: linear-gradient(transparent, rgba(0,0,0,0.85));
    padding: 40px 24px 20px;
    pointer-events: none;
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
  }
  #info-bar .photo-count {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-weight: 300;
    font-size: 11px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.5);
  }
  #info-bar .location-label {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-weight: 300;
    font-size: 11px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.5);
    text-align: right;
  }

  /* ── Year filter ── */
  #year-filter {
    position: absolute;
    bottom: 52px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    display: flex;
    gap: 2px;
    background: rgba(17,17,17,0.85);
    backdrop-filter: blur(12px);
    border-radius: 8px;
    padding: 4px;
    border: 1px solid rgba(255,255,255,0.08);
  }
  .year-btn {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-weight: 400;
    font-size: 11px;
    letter-spacing: 0.04em;
    color: rgba(255,255,255,0.4);
    background: none;
    border: none;
    padding: 7px 12px;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .year-btn:hover { color: rgba(255,255,255,0.7); background: rgba(255,255,255,0.05); }
  .year-btn.active {
    color: #fff;
    background: rgba(255,255,255,0.12);
  }

  /* ── Photo panel ── */
  #photo-panel {
    position: absolute;
    top: 0; right: 0;
    width: 520px;
    height: 100vh;
    z-index: 2000;
    background: #111;
    transform: translateX(100%);
    transition: transform 0.45s cubic-bezier(0.16, 1, 0.3, 1);
    display: flex;
    flex-direction: column;
    box-shadow: -4px 0 40px rgba(0,0,0,0.6);
    overflow: hidden;
  }
  #photo-panel.open { transform: translateX(0); }

  #panel-close {
    position: absolute;
    top: 16px; right: 16px;
    z-index: 10;
    width: 36px; height: 36px;
    border-radius: 50%;
    border: none;
    background: rgba(0,0,0,0.6);
    color: #fff;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
    backdrop-filter: blur(8px);
  }
  #panel-close:hover { background: rgba(0,0,0,0.8); }

  /* Nav arrows */
  .panel-nav {
    position: absolute;
    top: 50%;
    z-index: 10;
    width: 40px; height: 40px;
    border-radius: 50%;
    border: none;
    background: rgba(0,0,0,0.5);
    color: rgba(255,255,255,0.7);
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transform: translateY(-50%);
    transition: all 0.2s;
    backdrop-filter: blur(8px);
  }
  .panel-nav:hover { background: rgba(0,0,0,0.7); color: #fff; }
  #nav-prev { left: 12px; }
  #nav-next { right: 56px; }

  /* Tab switcher */
  #panel-tabs {
    display: flex;
    background: #1a1a1a;
    border-bottom: 1px solid #2a2a2a;
    flex-shrink: 0;
  }
  .panel-tab {
    flex: 1;
    padding: 14px 0;
    text-align: center;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-weight: 400;
    font-size: 11px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.4);
    cursor: pointer;
    border: none;
    border-bottom: 2px solid transparent;
    transition: all 0.25s;
    background: none;
  }
  .panel-tab:hover { color: rgba(255,255,255,0.7); }
  .panel-tab.active { color: #fff; border-bottom-color: #fff; }

  #panel-body {
    flex: 1;
    overflow: hidden;
    position: relative;
  }

  .panel-view {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
    overflow-y: auto;
  }
  .panel-view.active { opacity: 1; pointer-events: auto; }

  /* Photo view */
  #photo-view {
    align-items: center;
    justify-content: center;
    padding: 24px;
  }
  #photo-view img {
    max-width: 100%;
    max-height: 60vh;
    object-fit: contain;
    border-radius: 2px;
    background: #1a1a1a;
    transition: opacity 0.2s ease;
  }
  #photo-view img.loading {
    opacity: 0.3;
  }
  #photo-caption {
    margin-top: 20px;
    text-align: center;
    padding-bottom: 20px;
  }
  #photo-caption .location-name {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-size: 22px;
    font-weight: 500;
    color: #fff;
    margin-bottom: 6px;
  }
  #photo-caption .photo-date {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-size: 12px;
    font-weight: 300;
    letter-spacing: 0.08em;
    color: rgba(255,255,255,0.45);
  }
  #photo-caption .photo-tags {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-size: 11px;
    font-weight: 300;
    color: rgba(255,255,255,0.25);
    margin-top: 8px;
  }
  #photo-caption .tumblr-link {
    display: inline-block;
    margin-top: 12px;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-size: 11px;
    font-weight: 400;
    letter-spacing: 0.06em;
    color: rgba(255,255,255,0.3);
    text-decoration: none;
    border-bottom: 1px solid rgba(255,255,255,0.15);
    transition: all 0.2s;
  }
  #photo-caption .tumblr-link:hover { color: rgba(255,255,255,0.6); border-color: rgba(255,255,255,0.3); }

  /* Street view */
  #streetview-view { background: #0a0a0a; }
  #streetview-frame { width: 100%; height: 100%; border: none; }
  #streetview-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    padding: 40px;
    text-align: center;
  }
  #streetview-placeholder .icon { font-size: 48px; margin-bottom: 16px; opacity: 0.3; }
  #streetview-placeholder p {
    font-size: 13px;
    color: rgba(255,255,255,0.35);
    line-height: 1.6;
    max-width: 300px;
  }

  /* ── Custom markers ── */
  .photo-marker {
    width: 10px; height: 10px;
    border-radius: 50%;
    background: #d63031;
    border: 1.5px solid rgba(0,0,0,0.5);
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 1px 4px rgba(0,0,0,0.4), 0 0 6px rgba(214,48,49,0.4);
  }
  .photo-marker:hover {
    transform: scale(1.8);
    background: #ff4444;
    box-shadow: 0 0 12px rgba(255,68,68,0.6);
  }
  .photo-marker.active {
    background: #ff4444;
    transform: scale(2);
    box-shadow: 0 0 16px rgba(255,68,68,0.7);
  }

  /* Cluster styling */
  .marker-cluster {
    background: rgba(214,48,49,0.25) !important;
    border: 2px solid rgba(214,48,49,0.6) !important;
    border-radius: 50% !important;
  }
  .marker-cluster div {
    background: rgba(214,48,49,0.7) !important;
    color: #fff !important;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif !important;
    font-weight: 500 !important;
    font-size: 12px !important;
    width: 30px !important;
    height: 30px !important;
    margin-left: 0 !important;
    margin-top: 0 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    border-radius: 50% !important;
    line-height: 1 !important;
    text-align: center !important;
  }
  .marker-cluster-small {
    background: rgba(214,48,49,0.2) !important;
    width: 36px !important; height: 36px !important;
    display: flex !important; align-items: center !important; justify-content: center !important;
  }
  .marker-cluster-medium {
    background: rgba(214,48,49,0.3) !important;
    width: 42px !important; height: 42px !important;
    display: flex !important; align-items: center !important; justify-content: center !important;
  }
  .marker-cluster-large {
    background: rgba(214,48,49,0.4) !important;
    width: 48px !important; height: 48px !important;
    display: flex !important; align-items: center !important; justify-content: center !important;
  }

  /* Tooltip */
  .leaflet-tooltip.photo-tooltip {
    background: rgba(0,0,0,0.85);
    border: 1px solid rgba(255,255,255,0.1);
    color: #fff;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-size: 14px;
    padding: 6px 12px;
    border-radius: 4px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    backdrop-filter: blur(8px);
  }
  .leaflet-tooltip.photo-tooltip::before { border-top-color: rgba(0,0,0,0.85); }

  /* Leaflet overrides */
  .leaflet-control-zoom a {
    background: rgba(17,17,17,0.9) !important;
    color: #fff !important;
    border-color: #333 !important;
  }
  .leaflet-control-zoom a:hover { background: rgba(40,40,40,0.95) !important; }
  .leaflet-control-attribution {
    background: rgba(0,0,0,0.5) !important;
    color: rgba(255,255,255,0.3) !important;
    font-size: 10px !important;
  }
  .leaflet-control-attribution a { color: rgba(255,255,255,0.4) !important; }
  .leaflet-control-layers {
    background: rgba(17,17,17,0.9) !important;
    border: 1px solid #333 !important;
    color: #fff !important;
    border-radius: 6px !important;
  }

  /* Loading overlay */
  #loading {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: #0a0a0a;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: opacity 0.6s;
  }
  #loading.done { opacity: 0; pointer-events: none; }
  #loading h2 {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-weight: 500;
    font-size: 24px;
    color: rgba(255,255,255,0.6);
    margin-bottom: 8px;
  }
  #loading p {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-weight: 300;
    font-size: 12px;
    color: rgba(255,255,255,0.3);
  }

  @media (max-width: 700px) {
    #photo-panel { width: 100vw; }
    #title-overlay h1 { font-size: 22px; }
    .year-btn { padding: 6px 8px; font-size: 10px; }
  }
</style>
</head>
<body>

<!-- Loading -->
<div id="loading">
  <h2>Maps to Stockton</h2>
  <p>Loading photographs...</p>
</div>

<!-- Title -->
<div id="title-overlay">
  <h1>Maps to Stockton</h1>
  <div class="subtitle">Photographs by Brandon Getty</div>
</div>

<!-- Info bar -->
<div id="info-bar">
  <div class="photo-count" id="photo-count"></div>
  <div class="location-label">Stockton, California</div>
</div>

<!-- Year filter -->
<div id="year-filter">
  <button class="year-btn active" data-year="all">All Years</button>
  <button class="year-btn" data-year="2010">2010</button>
  <button class="year-btn" data-year="2011">2011</button>
  <button class="year-btn" data-year="2012">2012</button>
  <button class="year-btn" data-year="2013">2013</button>
  <button class="year-btn" data-year="2014">2014</button>
  <button class="year-btn" data-year="2015">2015</button>
  <button class="year-btn" data-year="2019">2019</button>
  <button class="year-btn" data-year="2022">2022</button>
</div>

<!-- Map -->
<div id="map"></div>

<!-- Photo panel -->
<div id="photo-panel">
  <button id="panel-close" aria-label="Close panel">&#x2715;</button>
  <button class="panel-nav" id="nav-prev" aria-label="Previous photo">&#x2039;</button>
  <button class="panel-nav" id="nav-next" aria-label="Next photo">&#x203A;</button>
  <div id="panel-tabs">
    <button class="panel-tab active" data-tab="photo">Photograph</button>
    <button class="panel-tab" data-tab="streetview">Street View · Now</button>
  </div>
  <div id="panel-body">
    <div id="photo-view" class="panel-view active">
      <img id="panel-photo" src="" alt="" />
      <div id="photo-caption">
        <div class="location-name" id="caption-location"></div>
        <div class="photo-date" id="caption-date"></div>
        <div class="photo-tags" id="caption-tags"></div>
        <a class="tumblr-link" id="caption-tumblr" href="#" target="_blank" rel="noopener">View on Tumblr</a>
      </div>
    </div>
    <div id="streetview-view" class="panel-view">
      <div id="streetview-placeholder">
        <div class="icon">&#x1F6F0;</div>
        <p id="streetview-msg">
          Street View requires a Google Maps API key.<br><br>
          Set the <code>GOOGLE_API_KEY</code> variable in source to enable.
        </p>
      </div>
      <iframe id="streetview-frame" style="display:none;" loading="lazy"></iframe>
    </div>
  </div>
</div>

<script>
// ═══════════════════════════════════════════
//  CONFIG
// ═══════════════════════════════════════════
const GOOGLE_API_KEY = 'AIzaSyB2y9l_4rZzinNZoH5SmijIK6NPpO3DCcs';

// ═══════════════════════════════════════════
//  PHOTO DATA (auto-generated)
// ═══════════════════════════════════════════
let PHOTOS = [];
let appInitialized = false;

function initializeApp() {
  if (appInitialized) return;
  appInitialized = true;
  

// ═══════════════════════════════════════════
//  MAP SETUP
// ═══════════════════════════════════════════
const STOCKTON = [37.9577, -121.2908];

const darkLayer = L.tileLayer(
  'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',
  { attribution: '&copy; OpenStreetMap &copy; CARTO', maxZoom: 19 }
);
const satelliteLayer = L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
  { attribution: 'Tiles &copy; Esri', maxZoom: 19 }
);
const lightLayer = L.tileLayer(
  'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',
  { attribution: '&copy; OpenStreetMap &copy; CARTO', maxZoom: 19 }
);

const map = L.map('map', {
  center: STOCKTON,
  zoom: 14,
  layers: [darkLayer],
  zoomControl: true,
});

L.control.layers({
  'Dark': darkLayer,
  'Satellite': satelliteLayer,
  'Light': lightLayer
}, null, { position: 'topright' }).addTo(map);

// ═══════════════════════════════════════════
//  MARKERS & CLUSTERING
// ═══════════════════════════════════════════
const clusterGroup = L.markerClusterGroup({
  maxClusterRadius: 35,
  spiderfyOnMaxZoom: true,
  showCoverageOnHover: false,
  zoomToBoundsOnClick: true,
  iconCreateFunction: function(cluster) {
    const count = cluster.getChildCount();
    let size = 'small';
    if (count > 10) size = 'medium';
    if (count > 30) size = 'large';
    return L.divIcon({
      html: '<div>' + count + '</div>',
      className: 'marker-cluster marker-cluster-' + size,
      iconSize: L.point(36, 36)
    });
  }
});

let activeMarkerEl = null;
const markerMap = new Map(); // photo id -> { marker, photo }
let visiblePhotos = [...PHOTOS]; // filtered list

function createMarkers(photos) {
  clusterGroup.clearLayers();
  markerMap.clear();

  photos.forEach(photo => {
    const icon = L.divIcon({
      className: '',
      html: `<div class="photo-marker" data-id="${photo.id}"></div>`,
      iconSize: [10, 10],
      iconAnchor: [5, 5]
    });

    const marker = L.marker([photo.lat, photo.lng], { icon })
      .bindTooltip(photo.title + (photo.date ? ', ' + photo.date : ''), {
        className: 'photo-tooltip',
        direction: 'top',
        offset: [0, -8]
      });

    marker.on('click', () => openPanel(photo));
    clusterGroup.addLayer(marker);
    markerMap.set(photo.id, { marker, photo });
  });

  map.addLayer(clusterGroup);
  document.getElementById('photo-count').textContent =
    `${photos.length} photograph${photos.length !== 1 ? 's' : ''}`;
}

// ═══════════════════════════════════════════
//  YEAR FILTER
// ═══════════════════════════════════════════
function getYear(dateStr) {
  if (!dateStr) return null;
  const match = dateStr.match(/(\d{4})/);
  return match ? match[1] : null;
}

document.querySelectorAll('.year-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.year-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    const year = btn.dataset.year;
    if (year === 'all') {
      visiblePhotos = [...PHOTOS];
    } else {
      visiblePhotos = PHOTOS.filter(p => getYear(p.date) === year);
    }
    createMarkers(visiblePhotos);
    closePanel();
  });
});

// ═══════════════════════════════════════════
//  PANEL
// ═══════════════════════════════════════════
const panel = document.getElementById('photo-panel');
const panelPhoto = document.getElementById('panel-photo');
const captionLocation = document.getElementById('caption-location');
const captionDate = document.getElementById('caption-date');
const captionTags = document.getElementById('caption-tags');
const captionTumblr = document.getElementById('caption-tumblr');
const streetviewFrame = document.getElementById('streetview-frame');
const streetviewPlaceholder = document.getElementById('streetview-placeholder');

let currentPhoto = null;

let isNavigating = false;

function openPanel(photo, opts = {}) {
  const wasOpen = panel.classList.contains('open');
  const isNav = opts.fromNav || false;
  currentPhoto = photo;

  // Highlight marker (may be inside cluster, so fail gracefully)
  if (activeMarkerEl) activeMarkerEl.classList.remove('active');
  const entry = markerMap.get(photo.id);
  if (entry) {
    const el = entry.marker.getElement();
    if (el) {
      const dot = el.querySelector('.photo-marker');
      if (dot) { dot.classList.add('active'); activeMarkerEl = dot; }
    }
  }

  // Photo — fade out during load to prevent flash
  panelPhoto.classList.add('loading');
  const newImg = new Image();
  newImg.onload = () => {
    panelPhoto.src = photo.imageUrl;
    panelPhoto.alt = photo.title;
    panelPhoto.classList.remove('loading');
  };
  newImg.onerror = () => {
    panelPhoto.src = photo.imageUrl;
    panelPhoto.classList.remove('loading');
  };
  newImg.src = photo.imageUrl;

  // Caption
  captionLocation.textContent = photo.title;
  captionDate.textContent = photo.date || '';
  captionTags.textContent = photo.tags.length ? photo.tags.map(t => '#' + t).join('  ') : '';
  if (photo.tumblrUrl) {
    captionTumblr.href = photo.tumblrUrl;
    captionTumblr.style.display = 'inline-block';
  } else {
    captionTumblr.style.display = 'none';
  }

  // Scroll photo view back to top
  document.getElementById('photo-view').scrollTop = 0;

  // Street View — only reload if not rapid-navigating
  if (!isNav) {
    if (GOOGLE_API_KEY) {
      streetviewPlaceholder.style.display = 'none';
      streetviewFrame.style.display = 'block';
      streetviewFrame.src = `https://www.google.com/maps/embed/v1/streetview?key=${GOOGLE_API_KEY}&location=${photo.lat},${photo.lng}&heading=0&pitch=0&fov=90`;
    } else {
      streetviewFrame.style.display = 'none';
      streetviewPlaceholder.style.display = 'flex';
    }
  }

  if (!wasOpen) switchTab('photo');
  panel.classList.add('open');

  // Pan map — skip rapid panning during arrow key navigation
  if (!isNav) {
    const panelWidth = window.innerWidth <= 700 ? 0 : 260;
    map.panTo([photo.lat, photo.lng], { animate: true });
    setTimeout(() => map.panBy([-panelWidth, 0], { animate: true }), 100);
  } else {
    // Debounced pan: only pan after user stops navigating for 400ms
    clearTimeout(openPanel._panTimer);
    openPanel._panTimer = setTimeout(() => {
      const panelWidth = window.innerWidth <= 700 ? 0 : 260;
      map.panTo([photo.lat, photo.lng], { animate: true, duration: 0.3 });
      setTimeout(() => map.panBy([-panelWidth, 0], { animate: true, duration: 0.3 }), 80);
      // Reload street view after settling
      if (GOOGLE_API_KEY && currentPhoto) {
        streetviewPlaceholder.style.display = 'none';
        streetviewFrame.style.display = 'block';
        streetviewFrame.src = `https://www.google.com/maps/embed/v1/streetview?key=${GOOGLE_API_KEY}&location=${currentPhoto.lat},${currentPhoto.lng}&heading=0&pitch=0&fov=90`;
      }
    }, 400);
  }
}

function closePanel() {
  panel.classList.remove('open');
  if (activeMarkerEl) { activeMarkerEl.classList.remove('active'); activeMarkerEl = null; }
  currentPhoto = null;
  streetviewFrame.src = '';
}

document.getElementById('panel-close').addEventListener('click', closePanel);
document.addEventListener('keydown', e => { if (e.key === 'Escape') closePanel(); });
map.on('click', e => {
  if (panel.classList.contains('open') && !e.originalEvent?.target?.closest('.photo-marker')) closePanel();
});

// Nav
function navigate(dir) {
  if (!currentPhoto) return;
  const idx = visiblePhotos.findIndex(p => p.id === currentPhoto.id);
  if (idx === -1) return;
  const next = (idx + dir + visiblePhotos.length) % visiblePhotos.length;
  openPanel(visiblePhotos[next], { fromNav: true });
}

document.getElementById('nav-prev').addEventListener('click', () => navigate(-1));
document.getElementById('nav-next').addEventListener('click', () => navigate(1));
document.addEventListener('keydown', e => {
  if (!currentPhoto) return;
  if (e.key === 'ArrowRight' || e.key === 'ArrowDown') { e.preventDefault(); navigate(1); }
  if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') { e.preventDefault(); navigate(-1); }
});

// Tabs
function switchTab(name) {
  document.querySelectorAll('.panel-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === name));
  document.querySelectorAll('.panel-view').forEach(v => v.classList.toggle('active', v.id === `${name}-view`));
}
document.querySelectorAll('.panel-tab').forEach(t => t.addEventListener('click', () => switchTab(t.dataset.tab)));

// ═══════════════════════════════════════════
//  INIT
// ═══════════════════════════════════════════
createMarkers(PHOTOS);
visiblePhotos = [...PHOTOS];

  // Dismiss loading
  setTimeout(() => document.getElementById('loading').classList.add('done'), 800);
  setTimeout(() => document.getElementById('loading').remove(), 1500);
}

fetch('photos.json')
  .then(r => r.json())
  .then(data => {
    PHOTOS = data;
    initializeApp();
  })
  .catch(err => {
    console.error('Failed to load photo data:', err);
    // Dismiss loading overlay even on error
    setTimeout(() => document.getElementById('loading').classList.add('done'), 800);
    setTimeout(() => document.getElementById('loading').remove(), 1500);
  });

</script>
